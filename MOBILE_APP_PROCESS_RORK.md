# Salesperson Mobile App - Rork Development Guide

This guide details the process and strategy to build the **Salesperson Mobile App** for the Jewellery Intelligence project using **Rork** (React Native/Expo).

## 1. Overview
We will use a "Hybrid AI-Grounded" approach.
*   **Frontend**: Native Mobile App generated by **Rork**.
*   **Backend**: Your existing Python FastAPI backend (local).
*   **Integration**: API calls from the mobile device to your PC's IP address.

## 2. Database Architecture (Important)
You mentioned your **PostgreSQL Database** is on another laptop (`10.100.101.152`).
**You do NOT need to change anything for the mobile app.**

*   **Mobile App (Phone)**: connects ONLY to your **API (This PC)**.
*   **API (This PC)**: connects to the **Database (Other Laptop)**.

**The Flow:**
`[Mobile Phone]` --(WiFi)--> `[FastAPI on This PC]` --(LAN)--> `[Postgres on Remote Laptop]`

**Rule**: The Mobile App must **never** try to connect to the database directly. It doesn't need the database password or IP. It only needs the API URL.

## 3. Prerequisites
Before starting with Rork, ensure you have:
1.  **Rork Account**: Active subscription or trial.
2.  **Expo Go App**: Installed on your real Android/iOS device (to preview the app).
3.  **Local Backend**: Your `salesperson-portal/backend` must be running.

---

## 3. Backend Preparation (Crucial Step)

The mobile app running on your phone needs to reach the backend running on your PC. By default, `localhost` on the phone refers to the phone itself, not your PC.

### Step 1: Find your Local IP Address
1.  Open Command Prompt (`cmd`) on your Windows PC.
2.  Run the command: `ipconfig`
3.  Look for **IPv4 Address** under your Wi-Fi or Ethernet adapter.
    *   *Example:* `192.168.1.15` (We will use this in the Rork prompt).

### Step 2: Run FastAPI on 0.0.0.0
You must tell FastAPI to listen on all network interfaces, not just localhost.
1.  Open your backend terminal.
2.  Navigate to: `c:\Users\kanimozhi.a\Downloads\JewelleryIntelligence project\salesperson-portal\backend`
3.  Run the server with this command:
    ```powershell
    uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
    ```
4.  **Test it**: Open browser on your **phone** and go to `http://<YOUR_IP>:8000/docs`. If it loads, you are ready.

---

## 4. Rork Development Steps (The Prompts)

Do not copy-paste everything at once. Rork works best with iterative prompts.

### Phase 1: Foundation & Navigation
**Goal:** Create the app shell and basic navigation structure.

> **Copy to Rork:**
> "Create a jewellery retail salesperson app using React Native and Expo.
> The app should have a modern, dark-themed UI (Navy Blue & White).
> Implement a Bottom Tab Navigator with 3 tabs:
> 1. 'Zones' (Home icon): For selecting store zones.
> 2. 'Active Session' (Play icon): For the current customer interaction.
> 3. 'Profile' (User icon): For salesperson stats.
> Use `lucide-react-native` for icons and `zustand` for state management to store the `currentZone` and `currentSessionId`."

### Phase 2: Zone Selection & Live Customers
**Goal:** connect to the `live-customers` endpoint.

> **Copy to Rork:**
> "Create a service file called `api.js` using Axios. Set the `baseURL` to `http://<YOUR_IP>:8000/api/operational` (Replace <YOUR_IP> with your actual IP, e.g., 192.168.1.15).
>
> On the 'Zones' screen:
> 1. Add buttons to select Zone A, B, or C.
> 2. When a zone is selected, call `GET /live-customers/{zone_id}`.
> 3. Display the results as a list of Cards.
> 4. Each Card should show:
>    - 'Customer {id}' (truncate the ID)
>    - 'Time: {detected_at}'
>    - An Image (decode the base64 `photo` field).
>    - A 'Start Service' button."

### Phase 3: Start Session Logic
**Goal:** Handle the "Start Service" action.

> **Copy to Rork:**
> "Update the 'Start Service' button logic:
> 1. When clicked, call the API `POST /sessions/start` with body: `{ customer_id: '...', salesperson_id: 'emp-101' }` (hardcode salesperson for now).
> 2. If successful, store the `session_id` in the global store.
> 3. Automatically navigate to the 'Active Session' tab."

### Phase 4: Active Session & Scanning
**Goal:** The main workspace for the salesperson.

> **Copy to Rork:**
> "On the 'Active Session' screen:
> 1. Show the current Session ID and Customer ID at the top.
> 2. Add a large 'Scan Jewellery' button.
> 3. Add a form/modal that simulates scanning (Validation: Input a barcode string).
> 4. When submitted, call API `POST /scan-jewellery` with body `{ session_id: ..., jewellery_code: '...' }`.
> 5. Below the button, show a list of scanned items by calling `GET /sessions/{session_id}/scans`.
> 6. Add a 'End Session' button that calls `POST /sessions/end/{session_id}` and clears the session."

---

## 5. Integration Checklist

| Feature | API Endpoint | Method | Status |
| :--- | :--- | :--- | :--- |
| **Get Live Customers** | `/api/operational/live-customers/{zone}` | GET | Pending |
| **Start Session** | `/api/operational/sessions/start` | POST | Pending |
| **Scan Item** | `/api/operational/scan-jewellery` | POST | Pending |
| **Get Scans** | `/api/operational/sessions/{id}/scans` | GET | Pending |
| **End Session** | `/api/operational/sessions/end/{id}` | POST | Pending |
| **Sales Stats** | `/api/operational/salesperson-stats/{id}` | GET | Pending |

## 6. Detailed App specifications 

### **1. Core Concept**
*   **App Name**: `JewelAssist`
*   **Target User**: Sales Staff on the floor.
*   **Primary Function**: To pair with an anonymous customer detected by CCTV, track the items shown to them, and log the interaction without asking for personal data.

### **2. Tech Stack (Rork Defaults)**
*   **Framework**: React Native (via Expo).
*   **Language**: JavaScript/TypeScript.
*   **State Management**: Zustand (Simple, fast global state).
*   **Networking**: Axios.
*   **UI Library**: NativeWind (Tailwind for React Native) or React Native Paper.

### **3. User Flow & Screens**

#### **Screen A: Login / Context Setup**
*   **Simple Input**: "Enter Employee ID" (e.g., `EMP001`).
*   **Action**: "Set Zone" (Dropdown: Zone A, Zone B, Zone C).
*   *Why?* The backend needs `salesperson_id` and `zone_id` for accurate data.

#### **Screen B: The "Radar" (Home Tab)**
*   **List View**: "Live Activity in Zone A".
*   **Cards**: Display detected customers.
    *   **Image**: Snapshot from CCTV (Base64 from backend).
    *   **Time**: "Entered 2 mins ago".
    *   **Status**: "Waiting" or "In Service".
*   **Action**: Button "Attend Customer".
    *   *Backend Call*: `POST /sessions/start` (Links Salesperson to Customer).

#### **Screen C: The "Session" (Active Tab)**
*   *This screen is active ONLY when a customer is being attended.*
*   **Header**: "Attending Customer #1234".
*   **Main Action**: "Scan Jewellery".
    *   *Interaction*: Opens Camera (or Manual Entry for PoC).
    *   *Backend Call*: `POST /scan-jewellery` (Sends Barcode).
*   **List**: "Items Shown".
    *   Shows list of scanned items (Name, Price, Photo).
*   **Footer Action**: "End Session".
    *   *Backend Call*: `POST /sessions/end`.

#### **Screen D: History / Performamce (Profile Tab)**
*   **Stats Board**:
    *   "Customers Attended Today: 12"
    *   "Items Shown Today: 45"
*   *Backend Call*: `GET /salesperson-stats/{id}`.

### **4. Design Guidelines for Rork**
*   **Theme**: "Premium Retail". Use Dark Blue (`#1a237e`), Gold (`#ffd700`) accents, and clean White backgrounds.
*   **Typography**: Clean sans-serif (Inter or Roboto).
*   **Components**: Large touch targets (buttons) for ease of use while standing.
